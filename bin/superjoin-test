#!/usr/bin/env node
'use strict';

let program = require('commander');
let pkg = require('../package.json');
let fs = require('fs');
let path = require('path');

program.version(pkg.version)
  .usage('[options]')
  .description('Runs a self check')
  .option('-v, --verbose', 'Enable console logging')
  .parse(process.argv);

if (program.verbose) {
  process.env.logLevel = 'debug';
}

let Mocha = require('mocha');
let mocha = new Mocha();

let testDir = path.join(__dirname, '../tests/selfcheck/');

fs.readdirSync(testDir).filter(function(file) {
  // Only keep the .js files
  return file.substr(-3) === '.js';

}).forEach(function(file) {
  mocha.addFile(
    path.join(testDir, file)
  );
});

mocha.run(function(failures) {
  process.on('exit', function () {
    process.exit(failures);
  });
});
