#!/usr/bin/env node
var program = require('commander'),
    pkg = require('../package.json'),
    path = require('path');

var grunt = require('grunt');

var Superjoin = require('../superjoin');

program.version(pkg.version)
    .usage('[options] <files ...>')
    .option('-o, --out <outfile>', 'Write joined file to <outfile>. If this option is not present write to STDOUT')
    .option('-a, --autoload', 'Enable autoloading of scripts that hadn\'t been added to the bundle file')
    .option('-b, --banner <banner>', 'Adds <banner> at the beginning of the bundle')
    .option('-r, --root <path>', 'Sets a root path')
    .option('-v, --verbose', 'Enable console logging')
    .parse(process.argv);

var superjoin = new Superjoin();

superjoin.verbose = program.verbose;
conf = superjoin.getConf();

superjoin.autoload = program.autoload;

if (program.args.length) {
    files = program.args;
}
else {
    files = conf.files || [];
    if (conf.root) {
        superjoin.root = path.resolve(process.cwd(), conf.root);
    }
}

if (program.root) {
    superjoin.root = path.resolve(process.cwd(), program.root);
}


var out = superjoin.join(files, conf.main);
if (program.out) {
    grunt.file.write(program.out, out);
}
else {
    process.stdout.write(out + '\n');
}